<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Drum Service</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Roboto:wght@400;700&display=swap"
        rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }

        .font-roboto {
            font-family: 'Roboto', sans-serif;
        }

        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* í…Œë§ˆë³„ ë°°ê²½ìƒ‰ ë³€ìˆ˜ - JSë¡œ ì œì–´ */
        .theme-infant {
            background-color: #FEE500;
            color: #191919;
        }

        .theme-elementary {
            background-color: #0064FF;
            color: white;
        }

        .theme-senior {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }

        .video-aspect {
            position: relative;
            padding-bottom: 56.25%;
            /* 16:9 ë¹„ìœ¨ */
            height: 0;
            overflow: hidden;
            background: #000;
            cursor: pointer;
        }

        .video-aspect iframe,
        .video-aspect img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* ì¬ìƒ ë²„íŠ¼ ì˜¤ë²„ë ˆì´ */
        .play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .video-aspect:hover .play-overlay {
            background: rgba(0, 0, 0, 0.1);
        }

        .play-icon {
            width: 60px;
            height: 40px;
            background: rgba(255, 0, 0, 0.9);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            transition: transform 0.2s;
        }

        .video-aspect:hover .play-icon {
            transform: scale(1.1);
            background: red;
        }

        /* íƒ­ í™œì„±í™” ìŠ¤íƒ€ì¼ */
        .tab-active {
            font-weight: 800;
            opacity: 1;
            border-bottom: 4px solid currentColor;
            border-radius: 2px;
        }

        .tab-inactive {
            opacity: 0.5;
            font-weight: 400;
            border-bottom: 2px solid transparent;
        }

        .tab-inactive:hover {
            opacity: 0.8;
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ê°„ê²© ì¡°ì • */
        select option {
            padding: 8px 4px;
            font-size: 15px;
        }
    </style>
</head>

<body class="min-h-screen transition-colors duration-300 theme-infant flex flex-col" id="mainBody">

    <header class="w-full mx-auto px-8 sm:px-12 pt-0 pb-0">

        <div class="flex justify-end items-end mb-2 text-xs sm:text-sm pb-1">
            <div class="flex gap-4 pb-1">
                <a href="https://smartdrum.co.kr/" target="_blank"
                    class="hover:underline flex items-center gap-1 font-roboto">
                    ìŠ¤ë§ˆíŠ¸ë“œëŸ¼ <i class="fa-solid fa-arrow-up-right-from-square text-[10px]"></i>
                </a>
                <a href="https://snsmartdrum.co.kr/" target="_blank"
                    class="hover:underline flex items-center gap-1 font-roboto">
                    ì‹œë‹ˆì–´ìŠ¤ë§ˆíŠ¸ë“œëŸ¼ <i class="fa-solid fa-arrow-up-right-from-square text-[10px]"></i>
                </a>
            </div>
        </div>

        <div class="flex flex-col md:flex-row justify-between items-end gap-4 mt-2">

            <div class="flex items-center gap-3 self-start md:self-end pb-4">
                <button id="adminTriggerBtn" class="text-3xl transition-transform active:scale-95 focus:outline-none">
                    <i class="fa-solid fa-drum text-red-500"></i>
                </button>
                <div class="flex flex-col items-start">
                    <h1 class="text-2xl font-roboto font-bold tracking-wide leading-none">Smart Drum</h1>
                    <div class="text-[10px] font-roboto tracking-[0.1em] uppercase mt-0.5 opacity-80">
                        Teacher Video Support Center
                    </div>
                </div>
            </div>

            <div class="flex gap-6 text-sm sm:text-base self-end w-full md:w-auto justify-end pb-0">
                <button onclick="switchTab('infant')" id="tab-infant"
                    class="tab-active flex items-center gap-1.5 pb-3 transition-all">
                    <span>ğŸ‘¶</span> ìœ ì•„ë“œëŸ¼
                </button>
                <button onclick="switchTab('elementary')" id="tab-elementary"
                    class="tab-inactive flex items-center gap-1.5 pb-3 transition-all">
                    <span>ğŸ«</span> ì´ˆë“±ë“œëŸ¼
                </button>
                <button onclick="switchTab('senior')" id="tab-senior"
                    class="tab-inactive flex items-center gap-1.5 pb-3 transition-all">
                    <span>ğŸ‘´</span> ì‹œë‹ˆì–´ë“œëŸ¼
                </button>
            </div>
        </div>
    </header>

    <div class="w-full mx-auto px-8 sm:px-12 mt-6 mb-8">
        <div id="controls-standard" class="flex flex-col sm:flex-row justify-end gap-3">
            <select id="categorySelect" onchange="filterVideos()"
                class="text-black p-2 rounded shadow w-full sm:w-40 outline-none h-12">
                <option value="all">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
            </select>
            <div class="relative w-full sm:w-60 h-12">
                <input type="text" id="searchInputStandard" onkeyup="filterVideos()" placeholder="ì œëª© ê²€ìƒ‰..."
                    class="w-full h-full p-2 pl-3 pr-10 rounded text-black outline-none shadow">
                <i class="fa-solid fa-magnifying-glass absolute right-3 top-3.5 text-gray-400"></i>
            </div>
        </div>

        <div id="controls-senior" class="hidden flex-col xl:flex-row justify-end items-end gap-3">
            <div class="flex flex-wrap gap-2 justify-end">
                <button onclick="setSeniorFilter('all')"
                    class="senior-filter-btn bg-white/20 hover:bg-white/40 px-3 py-1.5 rounded-full text-sm transition h-8"
                    data-filter="all">ì „ì²´ë³´ê¸°</button>
                <button onclick="setSeniorFilter('trot')"
                    class="senior-filter-btn bg-white/10 hover:bg-white/30 px-3 py-1.5 rounded-full text-sm transition h-8"
                    data-filter="trot">íŠ¸ë¡œíŠ¸Â·ê°€ìš”</button>
                <button onclick="setSeniorFilter('folk')"
                    class="senior-filter-btn bg-white/10 hover:bg-white/30 px-3 py-1.5 rounded-full text-sm transition h-8"
                    data-filter="folk">ê°€ê³¡Â·ë¯¼ìš”</button>
                <button onclick="setSeniorFilter('classic')"
                    class="senior-filter-btn bg-white/10 hover:bg-white/30 px-3 py-1.5 rounded-full text-sm transition h-8"
                    data-filter="classic">í´ë˜ì‹</button>
                <button onclick="setSeniorFilter('other')"
                    class="senior-filter-btn bg-white/10 hover:bg-white/30 px-3 py-1.5 rounded-full text-sm transition h-8"
                    data-filter="other">ê¸°íƒ€ìŒì•…</button>
                <button onclick="setSeniorFilter('warmup')"
                    class="senior-filter-btn bg-white/10 hover:bg-white/30 px-3 py-1.5 rounded-full text-sm transition h-8"
                    data-filter="warmup">ì¤€ë¹„ìš´ë™</button>
            </div>

            <div class="relative w-full sm:w-60 h-12 flex-shrink-0">
                <input type="text" id="searchInputSenior" onkeyup="filterVideos()" placeholder="ì œëª© ê²€ìƒ‰..."
                    class="w-full h-full p-2 pl-3 pr-10 rounded text-black outline-none shadow">
                <i class="fa-solid fa-magnifying-glass absolute right-3 top-3.5 text-gray-400"></i>
            </div>
        </div>
    </div>

    <main class="w-full mx-auto px-8 sm:px-12 pb-20 flex-grow">
        <div id="loadingIndicator" class="hidden justify-center py-10">
            <div class="loader"></div>
        </div>

        <div id="demoModeAlert"
            class="hidden max-w-2xl mx-auto mb-6 bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded shadow-md"
            role="alert">
            <p class="font-bold"><i class="fa-solid fa-info-circle"></i> GitHub Hosting Mode</p>
            <p class="text-sm">í˜„ì¬ GitHub Pagesì—ì„œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. ì˜ìƒ ëª©ë¡ì„ ì½ì–´ì™”ìœ¼ë‚˜, <strong>ë°ì´í„° ì¶”ê°€/ìˆ˜ì •/ì‚­ì œëŠ” ì„œë²„ì— ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</strong> (ìƒˆë¡œê³ ì¹¨ ì‹œ ì´ˆê¸°í™”)</p>
        </div>
        
        <div id="errorAlert"
            class="hidden max-w-2xl mx-auto mb-6 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded shadow-md"
            role="alert">
            <p class="font-bold"><i class="fa-solid fa-triangle-exclamation"></i> ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</p>
            <p class="text-sm">data/db.json íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„ì‹œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
        </div>

        <div id="videoGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        </div>

        <div id="noDataMessage" class="hidden text-center py-20 text-xl opacity-70">
            <i class="fa-solid fa-video-slash text-4xl mb-4 block"></i>
            ë“±ë¡ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.
        </div>
    </main>

    <footer class="w-full text-center py-6 text-xs opacity-60 border-t border-white/10 mt-auto">
        copyrightâ“’2008 JUEUNEDU. All rights reserved.
    </footer>

    <div id="toast"
        class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-lg opacity-0 transition-opacity duration-300 pointer-events-none z-50">
        ë©”ì‹œì§€ ë‚´ìš©
    </div>

    <div id="passwordModal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50">
        <div class="bg-white text-black p-6 rounded-lg shadow-xl w-80">
            <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                <i class="fa-solid fa-lock text-red-500"></i> ê´€ë¦¬ì ì ‘ê·¼
            </h3>
            <p class="text-sm text-gray-600 mb-2">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
            <input type="password" id="adminPasswordInput"
                class="w-full border p-2 rounded mb-4 focus:outline-none focus:border-blue-500" placeholder="Password">
            <div class="flex justify-end gap-2">
                <button onclick="closeModal('passwordModal')"
                    class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">ì·¨ì†Œ</button>
                <button onclick="checkAdminPassword()"
                    class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">í™•ì¸</button>
            </div>
        </div>
    </div>

    <div id="fullscreenVideoModal" class="fixed inset-0 bg-black z-[90] hidden flex-col items-center justify-center">
        <button onclick="closeFullscreenVideo()"
            class="absolute top-4 right-4 text-white/80 hover:text-white text-4xl z-[100] transition-colors">
            <i class="fa-solid fa-xmark"></i>
        </button>
        <div class="w-full h-full p-4 md:p-10 flex items-center justify-center">
            <div class="w-full max-w-7xl aspect-video bg-black shadow-2xl relative" id="fullscreenVideoContainer">
            </div>
        </div>
    </div>

    <div id="welcomeModal"
        class="fixed inset-0 w-full h-full bg-black/80 hidden items-start justify-center pt-32 z-[100]">
        <div
            class="bg-white p-0 rounded-lg shadow-2xl max-w-md w-full mx-4 overflow-hidden flex flex-col relative max-h-[90vh]">
            <div class="relative w-full flex justify-center bg-gray-100">
                <img src="https://senior100.co.kr/wp-content/uploads/2025/11/freepik__retouch__78404.jpeg" alt="Welcome"
                    class="max-w-full max-h-[60vh] aspect-square object-cover">
            </div>
            <div class="p-4 bg-white flex justify-center">
                <button onclick="closeWelcomeModal()"
                    class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition-colors text-lg">
                    ì…ì¥í•˜ê¸°
                </button>
            </div>
        </div>
    </div>

    <div id="editModal" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-[60]">
        <div class="bg-white text-black p-6 rounded-lg shadow-xl w-full max-w-lg mx-4">
            <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                <i class="fa-solid fa-pen-to-square text-blue-500"></i> ì˜ìƒ ì •ë³´ ìˆ˜ì •
            </h3>

            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-bold mb-1">êµ¬ë¶„</label>
                    <select id="editSection" class="w-full border p-2 rounded bg-gray-5">
                        <option value="infant">ğŸ‘¶ ìœ ì•„ë“œëŸ¼</option>
                        <option value="elementary">ğŸ« ì´ˆë“±ë“œëŸ¼</option>
                        <option value="senior">ğŸ‘´ ì‹œë‹ˆì–´ë“œëŸ¼</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-bold mb-1">ì¹´í…Œê³ ë¦¬</label>
                    <input type="text" id="editCategory" class="w-full border p-2 rounded" placeholder="ì¹´í…Œê³ ë¦¬">
                    <select id="editSeniorCategory" class="w-full border p-2 rounded hidden">
                        <option value="trot">íŠ¸ë¡œíŠ¸Â·ê°€ìš”</option>
                        <option value="folk">ê°€ê³¡Â·ë¯¼ìš”</option>
                        <option value="classic">í´ë˜ì‹</option>
                        <option value="other">ê¸°íƒ€ìŒì•…</option>
                        <option value="warmup">ì¤€ë¹„ìš´ë™</option>
                    </select>
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-bold mb-1">ì œëª©</label>
                <input type="text" id="editTitle" class="w-full border p-2 rounded" placeholder="ì˜ìƒ ì œëª©">
            </div>

            <div class="mb-4">
                <label class="block text-sm font-bold mb-1">ìœ íŠœë¸Œ/ë¹„ë©”ì˜¤ ë§í¬</label>
                <input type="text" id="editUrl" class="w-full border p-2 rounded" placeholder="YouTube or Vimeo URL">
            </div>

            <div class="mb-6">
                <label class="block text-sm font-bold mb-1">ë§Œë£Œì¼</label>
                <input type="date" id="editExpiry" class="w-full border p-2 rounded">
            </div>

            <input type="hidden" id="editIndex">

            <div class="flex justify-end gap-2">
                <button onclick="closeModal('editModal')"
                    class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">ì·¨ì†Œ</button>
                <button onclick="saveEditVideo()"
                    class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-bold">ìˆ˜ì • ì €ì¥</button>
            </div>
        </div>
    </div>

    <div id="adminPanel" class="fixed inset-0 bg-gray-100 text-black hidden z-50 overflow-y-auto">
        <div class="max-w-6xl mx-auto p-4 sm:p-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800"><i class="fa-solid fa-gear"></i> ì˜ìƒ ê´€ë¦¬ì ëª¨ë“œ</h2>
                <button onclick="closeAdminPanel()"
                    class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700">ë‚˜ê°€ê¸°</button>
            </div>

            <div class="bg-blue-50 border border-blue-200 p-4 rounded mb-6 text-sm text-blue-800">
                <i class="fa-solid fa-circle-info"></i> <strong>GitHub í˜¸ìŠ¤íŒ… ì£¼ì˜ì‚¬í•­:</strong> 
                í˜„ì¬ GitHub Pagesì—ì„œëŠ” ì„œë²„ ì €ì¥ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ìˆ˜ì •í•˜ê±°ë‚˜ ì¶”ê°€í•œ ë‚´ìš©ì€ ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ë©´ ì‚¬ë¼ì§‘ë‹ˆë‹¤. 
                ì˜êµ¬ì ì¸ ë³€ê²½ì´ í•„ìš”í•˜ë©´ ë¡œì»¬ì—ì„œ <code>db.json</code> íŒŒì¼ì„ ì§ì ‘ ìˆ˜ì •í•˜ì—¬ GitHubì— ë‹¤ì‹œ ì—…ë¡œë“œ(Push)í•´ì•¼ í•©ë‹ˆë‹¤.
            </div>

            <div class="bg-white p-6 rounded-lg shadow mb-8">
                <h3 class="text-lg font-bold mb-4 border-b pb-2">ì‹ ê·œ ì˜ìƒ ë“±ë¡</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-bold mb-1">êµ¬ë¶„</label>
                        <select id="newSection" class="w-full border p-2 rounded">
                            <option value="infant">ğŸ‘¶ ìœ ì•„ë“œëŸ¼</option>
                            <option value="elementary">ğŸ« ì´ˆë“±ë“œëŸ¼</option>
                            <option value="senior">ğŸ‘´ ì‹œë‹ˆì–´ë“œëŸ¼</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">ì¹´í…Œê³ ë¦¬</label>
                        <div id="categoryInputWrapper">
                            <input type="text" id="newCategory" class="w-full border p-2 rounded"
                                placeholder="ì˜ˆ: ë™ìš”, ê¸°ì´ˆ">
                        </div>
                        <select id="seniorCategorySelect" class="w-full border p-2 rounded hidden">
                            <option value="trot">íŠ¸ë¡œíŠ¸Â·ê°€ìš”</option>
                            <option value="folk">ê°€ê³¡Â·ë¯¼ìš”</option>
                            <option value="classic">í´ë˜ì‹</option>
                            <option value="other">ê¸°íƒ€ìŒì•…</option>
                            <option value="warmup">ì¤€ë¹„ìš´ë™</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">ë§Œë£Œì¼</label>
                        <input type="date" id="newExpiry" class="w-full border p-2 rounded" value="2100-12-31">
                    </div>
                </div>

                <div class="mb-2 text-sm text-gray-500">
                    <i class="fa-solid fa-circle-info"></i> ìœ íŠœë¸Œ ë˜ëŠ” ë¹„ë©”ì˜¤(Vimeo) ë§í¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ìë™ìœ¼ë¡œ ì¸ë„¤ì¼ê³¼ í”Œë ˆì´ì–´ê°€ ìƒì„±ë©ë‹ˆë‹¤.
                </div>

                <div id="newVideoInputs" class="space-y-3 mb-4">
                    <div class="flex flex-col sm:flex-row gap-2 video-input-row">
                        <input type="text" class="flex-1 border p-2 rounded title-input" placeholder="ì˜ìƒ ì œëª©">
                        <input type="text" class="flex-1 border p-2 rounded url-input"
                            placeholder="ìœ íŠœë¸Œ ë˜ëŠ” ë¹„ë©”ì˜¤ ë§í¬ (URL)">
                        <button onclick="removeInputRow(this)"
                            class="bg-red-100 text-red-500 p-2 rounded hover:bg-red-200" title="ì‚­ì œ"><i
                                class="fa-solid fa-trash"></i></button>
                    </div>
                </div>

                <div class="flex gap-2">
                    <button onclick="addInputRow()"
                        class="px-4 py-2 bg-blue-50 text-blue-600 rounded border border-blue-200 hover:bg-blue-100">
                        <i class="fa-solid fa-plus"></i> ì…ë ¥ì¹¸ ì¶”ê°€
                    </button>
                    <button onclick="saveNewVideos()"
                        class="flex-1 px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-bold shadow">
                        ì„ íƒëœ ì¡°ê±´ìœ¼ë¡œ ì˜ìƒ ì¼ê´„ ë“±ë¡
                    </button>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">ë“±ë¡ëœ ì˜ìƒ ëª©ë¡</h3>
                    <div class="text-sm text-gray-500" id="totalCount">ì´ 0ê°œ</div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left border-collapse">
                        <thead class="bg-gray-50 border-b">
                            <tr>
                                <th class="p-3 w-20">ìˆœì„œ</th>
                                <th class="p-3 w-24">êµ¬ë¶„</th>
                                <th class="p-3 w-24">ì¹´í…Œê³ ë¦¬</th>
                                <th class="p-3">ì œëª© / ë§í¬</th>
                                <th class="p-3 w-24">ë§Œë£Œì¼</th>
                                <th class="p-3 text-right w-40">ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="adminVideoList" class="divide-y">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- ì„¤ì • ë° ìƒíƒœ ---
        // ì¤‘ìš”: ê¹ƒí—ˆë¸Œì—ì„œëŠ” PHPê°€ ì‹¤í–‰ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ, data/db.json íŒŒì¼ì„ ì§ì ‘ ì½ë„ë¡ ì„¤ì • ë³€ê²½
        const DB_PATH = './data/db.json'; 
        
        // ë°ì´í„° ìƒíƒœ
        let allVideos = [];
        let currentTab = 'infant';
        let seniorFilter = 'all';
        let isAdmin = false;
        let isGitHubMode = true; // ê¹ƒí—ˆë¸Œ ëª¨ë“œ í™œì„±í™”

        // ê¸°ë³¸ ë°ì´í„° (ì´ˆê¸°í™” ì‹œ ë˜ëŠ” ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì‚¬ìš©)
        const DEFAULT_VIDEOS = [
            { id: 'infant-4', section: 'infant', category: '04ì£¼ì°¨', title: "ë„¤ëª¨ì˜ ê¿ˆ", url: 'https://youtu.be/getynu2wQbM?si=ZbcZ_1uR7FHvCy2p', expiry: '2100-12-31' },
            // í•„ìš”í•œ ê²½ìš° ì—¬ê¸°ì— ë” ë§ì€ ê¸°ë³¸ ë°ì´í„°ë¥¼ ë„£ì–´ë‘˜ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        ];

        // ê´€ë¦¬ì íŠ¸ë¦¬ê±° ìƒíƒœ
        let clickCount = 0;
        let clickTimer = null;

        // --- ì›°ì»´ ëª¨ë‹¬ ê¸°ëŠ¥ ---
        function checkWelcomeModal() {
            const lastDate = localStorage.getItem('lastWelcomeModalDate');
            const today = new Date().toISOString().split('T')[0];

            if (lastDate !== today) {
                const modal = document.getElementById('welcomeModal');
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeWelcomeModal() {
            const modal = document.getElementById('welcomeModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.body.style.overflow = '';

            // ì˜¤ëŠ˜ ë‚ ì§œ ì €ì¥
            const today = new Date().toISOString().split('T')[0];
            localStorage.setItem('lastWelcomeModalDate', today);
        }

        // --- ì´ˆê¸°í™” ---
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            setupEventListeners();
            checkWelcomeModal(); // ì›°ì»´ ëª¨ë‹¬ ì²´í¬
            const dateInputs = document.querySelectorAll('input[type="date"]');
            dateInputs.forEach(input => {
                if (!input.value) input.value = '2100-12-31';
            });
        });

        function setupEventListeners() {
            // ê´€ë¦¬ì ëª¨ë“œ íŠ¸ë¦¬ê±°
            const triggerBtn = document.getElementById('adminTriggerBtn');
            triggerBtn.addEventListener('click', () => {
                clickCount++;
                if (clickTimer) clearTimeout(clickTimer);
                clickTimer = setTimeout(() => { clickCount = 0; }, 2000);

                if (clickCount === 3) {
                    showToast('ê´€ë¦¬ì ëª¨ë“œ ì§„ì…ê¹Œì§€ 2ë²ˆ ë‚¨ì•˜ìŠµë‹ˆë‹¤.');
                } else if (clickCount >= 5) {
                    clickCount = 0;
                    document.getElementById('passwordModal').classList.replace('hidden', 'flex');
                    document.getElementById('adminPasswordInput').value = '';
                    document.getElementById('adminPasswordInput').focus();
                }
            });

            // ê´€ë¦¬ì ì‹ ê·œ ë“±ë¡ ì„¹ì…˜ ë³€ê²½
            document.getElementById('newSection').addEventListener('change', (e) => toggleCategoryInput(e.target.value, 'categoryInputWrapper', 'seniorCategorySelect'));

            // ìˆ˜ì • ëª¨ë‹¬ ì„¹ì…˜ ë³€ê²½
            document.getElementById('editSection').addEventListener('change', (e) => toggleCategoryInput(e.target.value, 'editCategory', 'editSeniorCategory', true));
        }

        function toggleCategoryInput(val, textId, selectId, isEdit = false) {
            const isSenior = val === 'senior';
            const textEl = document.getElementById(textId);
            const selectEl = document.getElementById(selectId);

            // isEditì¼ ê²½ìš° textIdëŠ” input ìì²´ì¼ ìˆ˜ë„ ìˆê³  wrapperì¼ ìˆ˜ë„ ìˆìŒ
            const textWrapper = isEdit ? textEl : textEl;

            if (isSenior) {
                textWrapper.classList.add('hidden');
                selectEl.classList.remove('hidden');
            } else {
                textWrapper.classList.remove('hidden');
                selectEl.classList.add('hidden');
            }
        }

        // --- ë°ì´í„° í†µì‹  (ìˆ˜ì •ë¨) ---
        async function loadData() {
            const loader = document.getElementById('loadingIndicator');
            const grid = document.getElementById('videoGrid');
            const noData = document.getElementById('noDataMessage');
            const demoAlert = document.getElementById('demoModeAlert');
            const errorAlert = document.getElementById('errorAlert');

            loader.classList.remove('hidden');
            loader.classList.add('flex');
            grid.innerHTML = '';
            noData.classList.add('hidden');
            demoAlert.classList.add('hidden');
            errorAlert.classList.add('hidden');

            try {
                // ê¹ƒí—ˆë¸Œì—ì„œëŠ” JSON íŒŒì¼ì„ ì§ì ‘ í˜¸ì¶œí•©ë‹ˆë‹¤.
                const res = await fetch(DB_PATH);
                
                if (!res.ok) {
                    // íŒŒì¼ì´ ì—†ëŠ” ê²½ìš° (404 ë“±)
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                
                const json = await res.json();
                
                // ë°ì´í„° êµ¬ì¡° í™•ì¸ (PHP ë˜í¼ê°€ ìˆëŠ”ì§€, ì•„ë‹ˆë©´ ìˆœìˆ˜ ë°°ì—´ì¸ì§€)
                if (Array.isArray(json)) {
                    allVideos = json;
                    // ì„±ê³µì ìœ¼ë¡œ ë¡œë“œí–ˆìœ¼ë¯€ë¡œ ê²½ê³  ë©”ì‹œì§€ ì—†ìŒ
                } else if (json.success && Array.isArray(json.data)) {
                    allVideos = json.data;
                } else {
                    allVideos = [];
                }
                
                if (allVideos.length === 0) {
                    // ë°ì´í„°ê°€ ë¹„ì–´ìˆìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©ì„ ê³ ë ¤í•  ìˆ˜ë„ ìˆìŒ
                    console.log("ë¡œë“œëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                }

            } catch (err) {
                console.warn('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨, ê¸°ë³¸ ë°ì´í„° ë˜ëŠ” ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í™•ì¸', err);
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í™•ì¸
                const saved = localStorage.getItem('smart_drum_db');
                if (saved) {
                    allVideos = JSON.parse(saved);
                    demoAlert.classList.remove('hidden'); // ë¡œì»¬ë°ì´í„° ì‚¬ìš©ì‹œ ì•Œë¦¼
                } else {
                    // ì •ë§ ì•„ë¬´ê²ƒë„ ì—†ìœ¼ë©´ ì—ëŸ¬ í‘œì‹œ í›„ ê¸°ë³¸ê°’ ì‚¬ìš©
                    // errorAlert.classList.remove('hidden'); // ì‚¬ìš©ì í˜¼ë€ ë°©ì§€ë¥¼ ìœ„í•´ ì—ëŸ¬ ìˆ¨ê¹€
                    demoAlert.classList.remove('hidden');
                    allVideos = [...DEFAULT_VIDEOS];
                }
            } finally {
                loader.classList.remove('flex');
                loader.classList.add('hidden');
                renderUI();
            }
        }

        async function saveData() {
            // ê¹ƒí—ˆë¸Œ í˜ì´ì§€ì—ì„œëŠ” ì„œë²„ ì €ì¥ì´ ë¶ˆê°€ëŠ¥í•˜ë¯€ë¡œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ë§Œ ì €ì¥í•˜ê³  ê²½ê³ 
            localStorage.setItem('smart_drum_db', JSON.stringify(allVideos));
            
            if (isGitHubMode) {
                alert('ì£¼ì˜: GitHub PagesëŠ” ì •ì  í˜¸ìŠ¤íŒ…ì´ë¯€ë¡œ ì„œë²„(db.json) íŒŒì¼ì´ ì‹¤ì œë¡œ ìˆ˜ì •ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\në³€ê²½ëœ ë‚´ìš©ì€ ë¸Œë¼ìš°ì € ì„ì‹œ ì €ì¥ì†Œì—ë§Œ ì €ì¥ë˜ë©°, ìƒˆë¡œê³ ì¹¨ ì‹œ ìœ ì§€ë˜ì§€ë§Œ ë‹¤ë¥¸ ì‚¬ëŒì—ê²ŒëŠ” ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
            
            showToast('ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            renderUI();
            if (isAdmin) renderAdminList();
        }

        // --- UI ë Œë”ë§ ---
        function switchTab(tabName) {
            currentTab = tabName;
            document.getElementById('mainBody').className = `min-h-screen transition-colors duration-300 flex flex-col theme-${tabName}`;

            ['infant', 'elementary', 'senior'].forEach(t => {
                const btn = document.getElementById(`tab-${t}`);
                if (t === tabName) btn.classList.replace('tab-inactive', 'tab-active');
                else btn.classList.replace('tab-active', 'tab-inactive');
            });

            const stdControls = document.getElementById('controls-standard');
            const snrControls = document.getElementById('controls-senior');

            if (tabName === 'senior') {
                stdControls.classList.add('hidden');
                snrControls.classList.remove('hidden');
                snrControls.classList.add('flex');
                seniorFilter = 'all';
                updateSeniorFilterBtns();
            } else {
                stdControls.classList.remove('hidden');
                stdControls.classList.add('flex');
                snrControls.classList.add('hidden');
                snrControls.classList.remove('flex');
            }

            document.getElementById('searchInputStandard').value = '';
            document.getElementById('searchInputSenior').value = '';
            renderUI();
        }

        function renderUI() {
            if (currentTab !== 'senior') updateCategorySelect();
            filterVideos();
        }

        function updateCategorySelect() {
            const select = document.getElementById('categorySelect');
            const currentVal = select.value;
            const categories = new Set();
            allVideos.forEach(v => {
                if (v.section === currentTab && v.category) categories.add(v.category);
            });
            select.innerHTML = '<option value="all">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>';
            Array.from(categories).sort().forEach(cat => {
                const opt = document.createElement('option');
                opt.value = cat;
                opt.textContent = cat;
                if (cat === currentVal) opt.selected = true;
                select.appendChild(opt);
            });
        }

        function updateSeniorFilterBtns() {
            document.querySelectorAll('.senior-filter-btn').forEach(btn => {
                if (btn.dataset.filter === seniorFilter) {
                    btn.classList.add('bg-white', 'text-black', 'font-bold');
                    btn.classList.remove('bg-white/10', 'bg-white/20');
                } else {
                    btn.classList.remove('bg-white', 'text-black', 'font-bold');
                    btn.classList.add('bg-white/10');
                }
            });
        }

        function setSeniorFilter(filter) {
            seniorFilter = filter;
            updateSeniorFilterBtns();
            filterVideos();
        }

        function filterVideos() {
            const grid = document.getElementById('videoGrid');
            const noData = document.getElementById('noDataMessage');
            const today = new Date().toISOString().split('T')[0];

            let filtered = allVideos.filter(v => v.section === currentTab);
            if (!isAdmin) {
                filtered = filtered.filter(v => !v.expiry || v.expiry >= today);
            }

            const keyword = currentTab === 'senior'
                ? document.getElementById('searchInputSenior').value.toLowerCase()
                : document.getElementById('searchInputStandard').value.toLowerCase();

            if (currentTab === 'senior') {
                if (seniorFilter !== 'all') filtered = filtered.filter(v => v.category === seniorFilter);
            } else {
                const catSelect = document.getElementById('categorySelect').value;
                if (catSelect !== 'all') filtered = filtered.filter(v => v.category === catSelect);
            }

            if (keyword) filtered = filtered.filter(v => v.title.toLowerCase().includes(keyword));

            grid.innerHTML = '';
            if (filtered.length === 0) noData.classList.remove('hidden');
            else {
                noData.classList.add('hidden');
                filtered.forEach(video => {
                    grid.appendChild(createVideoCard(video));
                });

                // ë¹„ë©”ì˜¤ ì¸ë„¤ì¼ ë¹„ë™ê¸° ë¡œë“œ í˜¸ì¶œ
                updateVimeoThumbnails();
            }
        }

        // --- í•µì‹¬: ìœ íŠœë¸Œ/ë¹„ë©”ì˜¤ ì˜¤ë¥˜ í•´ê²° ë° í†µí•©ì„ ìœ„í•œ Facade íŒ¨í„´ ì ìš© ---
        function createVideoCard(video) {
            const div = document.createElement('div');
            let cardBg = 'bg-white text-black';
            if (currentTab === 'senior') cardBg = 'bg-gray-800 text-white border border-gray-700';

            div.className = `${cardBg} rounded-lg overflow-hidden shadow-lg transform transition hover:-translate-y-1`;

            const videoInfo = getVideoInfo(video.url);
            let thumbUrl = '';
            let clickAction = '';
            let playIcon = '<i class="fa-solid fa-play"></i>';
            let fullscreenBtn = '';
            let imgDataAttrs = '';
            let imgClass = 'w-full h-full object-cover';

            if (videoInfo) {
                if (videoInfo.type === 'youtube') {
                    thumbUrl = `https://img.youtube.com/vi/${videoInfo.id}/hqdefault.jpg`;
                    clickAction = `onclick="playVideo('${video.id}', '${videoInfo.id}', 'youtube')"`;
                    fullscreenBtn = `
                        <button onclick="openFullscreenVideo(event, '${videoInfo.id}', 'youtube')" 
                            class="absolute top-2 right-2 text-white bg-black/50 hover:bg-black/70 rounded-lg p-2 transition-colors z-20" 
                            title="ì „ì²´í™”ë©´ìœ¼ë¡œ ì¬ìƒ">
                            <i class="fa-solid fa-expand"></i>
                        </button>
                    `;
                } else if (videoInfo.type === 'vimeo') {
                    // ë¹„ë©”ì˜¤ëŠ” ì´ˆê¸°ì— í”Œë ˆì´ìŠ¤í™€ë”ë¥¼ ë³´ì—¬ì£¼ê³ , JSë¡œ ë‚˜ì¤‘ì— ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
                    thumbUrl = 'https://placehold.co/600x400/00ADEF/FFFFFF?text=Vimeo+Video';
                    imgDataAttrs = `data-vimeo-id="${videoInfo.id}"`;
                    imgClass += ' vimeo-thumb'; // ë‚˜ì¤‘ì— ì‹ë³„í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤

                    clickAction = `onclick="playVideo('${video.id}', '${videoInfo.id}', 'vimeo')"`;
                    fullscreenBtn = `
                        <button onclick="openFullscreenVideo(event, '${videoInfo.id}', 'vimeo')" 
                            class="absolute top-2 right-2 text-white bg-black/50 hover:bg-black/70 rounded-lg p-2 transition-colors z-20" 
                            title="ì „ì²´í™”ë©´ìœ¼ë¡œ ì¬ìƒ">
                            <i class="fa-solid fa-expand"></i>
                        </button>
                    `;
                }
            } else {
                // Non-Video Link Handling
                thumbUrl = 'https://placehold.co/600x400/EEE/31343C?text=External+Link';
                clickAction = `onclick="window.open('${video.url}', '_blank')"`;
                playIcon = '<i class="fa-solid fa-arrow-up-right-from-square"></i>';
            }

            const seniorCatMap = { 'trot': 'íŠ¸ë¡œíŠ¸Â·ê°€ìš”', 'folk': 'ê°€ê³¡Â·ë¯¼ìš”', 'classic': 'í´ë˜ì‹', 'other': 'ê¸°íƒ€ìŒì•…', 'warmup': 'ì¤€ë¹„ìš´ë™' };
            const displayCat = (video.section === 'senior' && seniorCatMap[video.category]) ? seniorCatMap[video.category] : video.category;

            div.innerHTML = `
                <div class="video-aspect" id="video-container-${video.id}" ${clickAction}>
                    ${fullscreenBtn}
                    <img src="${thumbUrl}" alt="${video.title}" loading="lazy" class="${imgClass}" ${imgDataAttrs}>
                    <div class="play-overlay">
                        <div class="play-icon">${playIcon}</div>
                    </div>
                </div>
                <div class="p-4">
                    <div class="text-base mb-2 flex justify-between items-center">
                        <span class="font-bold bg-blue-100 text-blue-800 px-2 py-1 rounded shadow-sm">${displayCat}</span>
                        ${video.expiry < new Date().toISOString().split('T')[0] ? '<span class="text-red-500 font-bold">ë§Œë£Œë¨</span>' : ''}
                    </div>
                    <h3 class="font-bold text-2xl leading-tight" title="${video.title}">${video.title}</h3>
                </div>
            `;
            return div;
        }

        // ë¹„ë©”ì˜¤ ì¸ë„¤ì¼ ë¹„ë™ê¸° ì—…ë°ì´íŠ¸
        function updateVimeoThumbnails() {
            const vimeoImages = document.querySelectorAll('img.vimeo-thumb');
            vimeoImages.forEach(async img => {
                // ì´ë¯¸ ë¡œë“œëœ ê²½ìš° íŒ¨ìŠ¤
                if (img.dataset.loaded === 'true') return;

                const videoId = img.dataset.vimeoId;
                if (!videoId) return;

                try {
                    // Vimeo oEmbed API ì‚¬ìš©
                    const response = await fetch(`https://vimeo.com/api/oembed.json?url=https://vimeo.com/${videoId}`);
                    const data = await response.json();

                    if (data.thumbnail_url) {
                        img.src = data.thumbnail_url;
                        img.dataset.loaded = 'true'; // ì¤‘ë³µ ìš”ì²­ ë°©ì§€
                    }
                } catch (error) {
                    console.error('Vimeo thumbnail fetch error:', error);
                }
            });
        }

        function playVideo(containerId, videoId, type) {
            const container = document.getElementById(`video-container-${containerId}`);
            let iframeSrc = '';

            if (type === 'youtube') {
                iframeSrc = `https://www.youtube.com/embed/${videoId}?autoplay=1&origin=${location.origin}`;
            } else if (type === 'vimeo') {
                iframeSrc = `https://player.vimeo.com/video/${videoId}?autoplay=1&title=0&byline=0&portrait=0`;
            }

            container.innerHTML = `
                <iframe 
                    src="${iframeSrc}" 
                    title="Video player" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                    allowfullscreen>
                </iframe>
            `;
            // onclick ì´ë²¤íŠ¸ ì œê±° (ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€)
            container.onclick = null;
        }

        function getVideoInfo(url) {
            if (!url) return null;

            // YouTube
            if (url.includes('youtu.be/') || url.includes('youtube.com/') || url.includes('youtube-nocookie.com/')) {
                let id = '';
                if (url.includes('youtu.be/')) id = url.split('youtu.be/')[1].split('?')[0];
                else if (url.includes('v=')) id = url.split('v=')[1].split('&')[0];
                else if (url.includes('embed/')) id = url.split('embed/')[1].split('?')[0];
                return { type: 'youtube', id: id };
            }

            // Vimeo
            if (url.includes('vimeo.com/')) {
                // https://vimeo.com/123456789
                // https://vimeo.com/channels/staffpicks/123456789
                const matches = url.match(/vimeo\.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/);
                if (matches && matches[1]) {
                    return { type: 'vimeo', id: matches[1] };
                }
            }

            return null;
        }

        // --- ì „ì²´í™”ë©´ ë¹„ë””ì˜¤ ê¸°ëŠ¥ ---
        function openFullscreenVideo(event, videoId, type) {
            event.stopPropagation(); // ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
            const modal = document.getElementById('fullscreenVideoModal');
            const container = document.getElementById('fullscreenVideoContainer');

            let iframeSrc = '';
            if (type === 'youtube') {
                iframeSrc = `https://www.youtube.com/embed/${videoId}?autoplay=1&origin=${location.origin}`;
            } else if (type === 'vimeo') {
                iframeSrc = `https://player.vimeo.com/video/${videoId}?autoplay=1&title=0&byline=0&portrait=0`;
            }

            container.innerHTML = `
                <iframe 
                    src="${iframeSrc}" 
                    class="w-full h-full rounded-lg"
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                    allowfullscreen>
                </iframe>
            `;

            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden'; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€
        }

        function closeFullscreenVideo() {
            const modal = document.getElementById('fullscreenVideoModal');
            const container = document.getElementById('fullscreenVideoContainer');

            modal.classList.add('hidden');
            modal.classList.remove('flex');
            container.innerHTML = ''; // ë¹„ë””ì˜¤ ì¤‘ì§€
            document.body.style.overflow = ''; // ìŠ¤í¬ë¡¤ ë³µì›
        }

        // ESC í‚¤ë¡œ ì „ì²´í™”ë©´ ë‹«ê¸°
        document.addEventListener('keydown', function (event) {
            if (event.key === "Escape") {
                const modal = document.getElementById('fullscreenVideoModal');
                if (!modal.classList.contains('hidden')) {
                    closeFullscreenVideo();
                }
            }
        });

        // --- ê´€ë¦¬ì ê¸°ëŠ¥ ---
        function checkAdminPassword() {
            if (document.getElementById('adminPasswordInput').value === '3323') {
                isAdmin = true;
                closeModal('passwordModal');
                openAdminPanel();
                document.getElementById('adminPasswordInput').value = '';
            } else {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }

        function openAdminPanel() {
            document.getElementById('adminPanel').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('block');
            renderAdminList();
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('block');
            isAdmin = false;
            loadData();
        }

        function renderAdminList() {
            const tbody = document.getElementById('adminVideoList');
            document.getElementById('totalCount').textContent = `ì´ ${allVideos.length}ê°œ`;
            tbody.innerHTML = '';

            // ìˆœì„œëŒ€ë¡œ ì¶œë ¥ (ì‚¬ìš©ìì—ê²Œ ë³´ì´ëŠ” ìˆœì„œ)
            allVideos.forEach((video, index) => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-gray-50 border-b";

                const sectionMap = { 'infant': 'ğŸ‘¶ ìœ ì•„', 'elementary': 'ğŸ« ì´ˆë“±', 'senior': 'ğŸ‘´ ì‹œë‹ˆì–´' };
                const isFirst = index === 0;
                const isLast = index === allVideos.length - 1;

                tr.innerHTML = `
                    <td class="p-3 text-center">
                        <div class="flex flex-col gap-1">
                            <button onclick="moveVideo(${index}, -1)" class="text-xs bg-gray-200 hover:bg-gray-300 rounded px-2 py-0.5 ${isFirst ? 'invisible' : ''}">â–²</button>
                            <button onclick="moveVideo(${index}, 1)" class="text-xs bg-gray-200 hover:bg-gray-300 rounded px-2 py-0.5 ${isLast ? 'invisible' : ''}">â–¼</button>
                        </div>
                    </td>
                    <td class="p-3 text-sm">${sectionMap[video.section] || video.section}</td>
                    <td class="p-3 text-sm text-gray-600">${video.category}</td>
                    <td class="p-3 font-medium">
                        <div class="truncate max-w-xs text-sm">${video.title}</div>
                        <div class="text-xs text-blue-400 truncate max-w-xs cursor-pointer hover:underline" onclick="window.open('${video.url}')">${video.url}</div>
                    </td>
                    <td class="p-3 text-xs">${video.expiry}</td>
                    <td class="p-3 text-right">
                        <button onclick="openEditModal(${index})" class="bg-blue-100 text-blue-600 px-3 py-1 rounded text-xs hover:bg-blue-200 mr-1">ìˆ˜ì •</button>
                        <button onclick="deleteVideo(${index})" class="bg-red-100 text-red-600 px-3 py-1 rounded text-xs hover:bg-red-200">ì‚­ì œ</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // --- ìˆœì„œ ë³€ê²½ ê¸°ëŠ¥ ---
        function moveVideo(index, direction) {
            // direction: -1 (up/prev), 1 (down/next)
            if (direction === -1 && index > 0) {
                [allVideos[index], allVideos[index - 1]] = [allVideos[index - 1], allVideos[index]];
            } else if (direction === 1 && index < allVideos.length - 1) {
                [allVideos[index], allVideos[index + 1]] = [allVideos[index + 1], allVideos[index]];
            }
            saveData(); // ë³€ê²½ ì¦‰ì‹œ ì €ì¥
        }

        // --- ìˆ˜ì • ê¸°ëŠ¥ ---
        function openEditModal(index) {
            const video = allVideos[index];
            document.getElementById('editIndex').value = index;
            document.getElementById('editSection').value = video.section;
            document.getElementById('editTitle').value = video.title;
            document.getElementById('editUrl').value = video.url;
            document.getElementById('editExpiry').value = video.expiry;

            // ì¹´í…Œê³ ë¦¬ ì„¸íŒ…
            toggleCategoryInput(video.section, 'editCategory', 'editSeniorCategory', true);
            if (video.section === 'senior') {
                document.getElementById('editSeniorCategory').value = video.category;
            } else {
                document.getElementById('editCategory').value = video.category;
            }

            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editModal').classList.add('flex');
        }

        function saveEditVideo() {
            const index = parseInt(document.getElementById('editIndex').value);
            const section = document.getElementById('editSection').value;
            let category = '';

            if (section === 'senior') {
                category = document.getElementById('editSeniorCategory').value;
            } else {
                category = document.getElementById('editCategory').value.trim();
                if (!category) return alert('ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }

            const title = document.getElementById('editTitle').value.trim();
            const url = document.getElementById('editUrl').value.trim();
            const expiry = document.getElementById('editExpiry').value;

            if (!title || !url) return alert('ì œëª©ê³¼ ë§í¬ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');

            // ë°ì´í„° ì—…ë°ì´íŠ¸
            allVideos[index] = {
                ...allVideos[index],
                section, category, title, url, expiry
            };

            closeModal('editModal');
            saveData(); // ì¦‰ì‹œ ì €ì¥
        }

        // --- ì‚­ì œ ê¸°ëŠ¥ ---
        function deleteVideo(index) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                allVideos.splice(index, 1);
                saveData(); // ì¦‰ì‹œ ì €ì¥
            }
        }

        // --- ì‹ ê·œ ë“±ë¡ ê¸°ëŠ¥ ---
        function addInputRow() {
            const container = document.getElementById('newVideoInputs');
            const row = document.createElement('div');
            row.className = "flex flex-col sm:flex-row gap-2 video-input-row";
            row.innerHTML = `
                <input type="text" class="flex-1 border p-2 rounded title-input" placeholder="ì˜ìƒ ì œëª©">
                <input type="text" class="flex-1 border p-2 rounded url-input" placeholder="ìœ íŠœë¸Œ ë˜ëŠ” ë¹„ë©”ì˜¤ ë§í¬ (URL)">
                <button onclick="removeInputRow(this)" class="bg-red-100 text-red-500 p-2 rounded hover:bg-red-200" title="ì‚­ì œ"><i class="fa-solid fa-trash"></i></button>
            `;
            container.appendChild(row);
        }

        function removeInputRow(btn) {
            const rows = document.querySelectorAll('.video-input-row');
            if (rows.length > 1) btn.closest('.video-input-row').remove();
            else {
                const row = btn.closest('.video-input-row');
                row.querySelector('.title-input').value = '';
                row.querySelector('.url-input').value = '';
            }
        }

        function saveNewVideos() {
            const section = document.getElementById('newSection').value;
            let category = '';
            if (section === 'senior') category = document.getElementById('seniorCategorySelect').value;
            else {
                category = document.getElementById('newCategory').value.trim();
                if (!category) return alert('ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
            const expiry = document.getElementById('newExpiry').value;

            const newItems = [];
            document.querySelectorAll('.video-input-row').forEach(row => {
                const title = row.querySelector('.title-input').value.trim();
                const url = row.querySelector('.url-input').value.trim();
                if (title && url) {
                    newItems.push({
                        id: Date.now() + Math.random().toString(36).substr(2, 9),
                        section, category, title, url, expiry
                    });
                }
            });

            if (newItems.length === 0) return alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì˜ìƒì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');

            // ìƒˆ ì˜ìƒì„ ë¦¬ìŠ¤íŠ¸ ë§¨ ì•ì— ì¶”ê°€ (ìµœì‹ ìˆœ) í˜¹ì€ ë§¨ ë’¤ì— (ë“±ë¡ìˆœ).
            // ì‚¬ìš©ìê°€ ìˆœì„œ ë³€ê²½ ê°€ëŠ¥í•˜ë¯€ë¡œ ì—¬ê¸°ì„  ë§¨ ë’¤ì— ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤.
            allVideos = [...allVideos, ...newItems];

            saveData();

            // ì´ˆê¸°í™”
            document.getElementById('newCategory').value = '';
            const inputContainer = document.getElementById('newVideoInputs');
            inputContainer.innerHTML = '';
            addInputRow();

            showToast(`${newItems.length}ê°œì˜ ì˜ìƒì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        // --- ê³µí†µ ---
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.remove('opacity-0');
            setTimeout(() => toast.classList.add('opacity-0'), 3000);
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
            document.getElementById(id).classList.remove('flex');
        }
    </script>
</body>

</html>
